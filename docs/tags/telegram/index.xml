<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" 
     xmlns:atom="http://www.w3.org/2005/Atom"
     xmlns:content="http://purl.org/rss/1.0/modules/content/"
     xmlns:dc="http://purl.org/dc/elements/1.1/"
     xmlns:media="http://search.yahoo.com/mrss/">
  <channel>
    <title>Telegram auf Nicky Reinert</title>
    <link>http://localhost:1313/tags/telegram/</link>
    <description>Blog &amp; Projekte von Nicky Reinert (Institut f√ºr digitale Herausforderungen): Webentwicklung &amp; Software Development, SEO &amp; Analytics, Hosting &amp; DevOps, WordPress &amp; Hugo, Tools &amp; Projekte, Datenschutz und digitale Kultur ‚Äì plus Texte zu KI sowie Autismus &amp; Gesellschaft.</description>
    <generator>Hugo 0.148.2</generator>
    <language>de</language>
    <managingEditor></managingEditor>
    <webMaster></webMaster>
    <copyright></copyright>
    <lastBuildDate>Sun, 16 Feb 2025 12:34:56 +0200</lastBuildDate><atom:link href="http://localhost:1313/tags/telegram/index.xml" rel="self" type="application/rss+xml" /><item>
      <title>PoneyHot - frisst Clickbait und Fake News</title>
      <link>http://localhost:1313/2025/2025-02-16-poney-hot/</link>
      <pubDate>Sun, 16 Feb 2025 12:34:56 +0200</pubDate>
      <author></author>
      <guid>http://localhost:1313/2025/2025-02-16-poney-hot/</guid>
      <description> Das Internet ist voll von Fake News und Clickbait, was es schwierig macht, vertrauensw√ºrdige Informationen zu finden. PoneyHot hilft Ihnen, den L√§rm zu ‚Ä¶</description>
      
      
      <content:encoded>&lt;![CDATA[
        
        <div class="ai-summary">
          <h3>AI-Zusammenfassung</h3>
          <p>Eine Vorstellung von &#39;PoneyHot&#39;, einem Tool zur Bek√§mpfung von Fake News und Clickbait. Der Artikel beschreibt die Funktionen des Tools, das Artikel zusammenfasst und Behauptungen faktenpr√ºft. Es wird erkl√§rt, wie PoneyHot als Firefox-Erweiterung (via Kontextmen√º) und als Telegram-Bot (via spezielle Pr√§fixe) genutzt werden kann, um Nutzern zu helfen, schnell zu verifizierten Informationen zu gelangen.</p>
          
          
          <p><strong>Hauptthemen:</strong> Fake News, Clickbait, Faktenpr√ºfung, Textzusammenfassung, Browser-Erweiterung, Telegram-Bot, KI-Anwendung</p>
          
          
          
          <p><strong>Schwierigkeitsgrad:</strong> beginner</p>
          
        </div>
        
        
        <figure class="center"><img src="/2025/2025-02-16-poney-hot/gfx/poneyHot.png"
    alt="PoneyHot Logo" width="200">
</figure>

<p>Das Internet ist voll von <strong>Fake News</strong> und <strong>Clickbait</strong>, was es schwierig macht, vertrauensw√ºrdige Informationen zu finden. <strong>PoneyHot</strong> hilft Ihnen, den L√§rm zu durchbrechen, indem es <strong>Inhalte zusammenfasst</strong> und <strong>Behauptungen √ºberpr√ºft</strong>‚Äîschnell und einfach.</p>
<h2 id="was-ist-poneyhot">Was ist PoneyHot?</h2>
<p>PoneyHot ist ein Tool, das Ihnen hilft, <strong>direkt zu den Fakten zu kommen</strong>. Egal, ob Sie Online-Artikel durchsuchen oder virale Behauptungen √ºberpr√ºfen, PoneyHot macht es m√ºhelos, Fakten von Fiktion zu trennen.</p>
<p>Es funktioniert auf zwei einfache Arten:</p>
<ul>
<li><strong>Zusammenfassung</strong>: Fasst Artikel schnell zusammen, sodass Sie keine Zeit mit unn√∂tigem Ballast verschwenden.</li>
<li><strong>Faktenpr√ºfung</strong>: √úberpr√ºft Behauptungen sofort, sodass Sie Fehlinformationen erkennen k√∂nnen.</li>
</ul>
<h2 id="wie-benutzt-man-poneyhot">Wie benutzt man PoneyHot?</h2>
<h3 id="firefox-erweiterung"><strong>Firefox-Erweiterung</strong></h3>
<ul>
<li><strong>Artikel zusammenfassen</strong>: Klicken Sie mit der rechten Maustaste auf einen Link und w√§hlen Sie <strong>&ldquo;Zusammenfassen&rdquo;</strong>‚ÄîPoneyHot erstellt eine kurze, klare Zusammenfassung.</li>
</ul>
<figure class="center"><img src="/2025/2025-02-16-poney-hot/gfx/poneyhot-summarize-context-menu-firefox.png"
    alt="PoneyHot Logo" width="500">
</figure>

<ul>
<li><strong>Behauptungen √ºberpr√ºfen</strong>: Markieren Sie eine Aussage, klicken Sie mit der rechten Maustaste und w√§hlen Sie <strong>&ldquo;Fakten pr√ºfen&rdquo;</strong>, um sie sofort zu √ºberpr√ºfen.</li>
</ul>
<figure class="center"><img src="/2025/2025-02-16-poney-hot/gfx/poneyhot-fact-check-firefox.png"
    alt="PoneyHot Logo" width="900">
</figure>

<h3 id="telegram-bot"><strong>Telegram-Bot</strong></h3>
<ul>
<li>Senden Sie dem Bot eine <strong>URL</strong>, und er gibt eine Zusammenfassung zur√ºck.</li>
<li>Pr√§fixen Sie eine Nachricht mit <code>???</code> f√ºr eine <strong>Faktenpr√ºfung</strong> oder <code>!!!</code> f√ºr eine <strong>Zusammenfassung</strong>.</li>
<li>Teilen Sie Links direkt von Ihrem Mobilger√§t f√ºr eine sofortige Analyse.</li>
</ul>
<h2 id="warum-poneyhot-verwenden">Warum PoneyHot verwenden?</h2>
<ul>
<li><strong>Zeit sparen</strong>: √úberspringen Sie lange Artikel und kommen Sie direkt zu den wichtigsten Punkten.</li>
<li><strong>Clickbait vermeiden</strong>: Erfahren Sie, worum es in einem Artikel wirklich geht, bevor Sie klicken.</li>
<li><strong>Informationen √ºberpr√ºfen</strong>: Fallen Sie nicht auf Fake News herein‚Äî√ºberpr√ºfen Sie sie m√ºhelos.</li>
</ul>
<h2 id="√ºbernehmen-sie-die-kontrolle-√ºber-ihr-online-erlebnis">√úbernehmen Sie die Kontrolle √ºber Ihr Online-Erlebnis</h2>
<p>PoneyHot hilft Ihnen, <strong>informiert zu bleiben, ohne den L√§rm</strong>. Egal, ob Sie Nachrichten lesen, Themen recherchieren oder Behauptungen √ºberpr√ºfen, PoneyHot sorgt daf√ºr, dass Sie <strong>klare, zuverl√§ssige und √ºberpr√ºfte Informationen</strong> schnell erhalten.</p>
<p>Probieren Sie PoneyHot noch heute aus und surfen Sie mit Vertrauen!</p>
<hr>
<p>üìå <strong>Folgen Sie uns f√ºr Updates und tragen Sie auf GitHub bei:</strong> <a href="https://github.com/nickyreinert/poneyHot">github.com/nickyreinert/poneyHot</a></p>

        
        
        <div class="tags">
          <p><strong>Tags:</strong> PoneyHot, Fake News, KI, Browser-Erweiterung, Telegram</p>
        </div>
        
      ]]></content:encoded>
      
      
      
      <category>projekte</category>
      
      
      
      
      <media:content url="http://localhost:1313/gfx/poneyHot.png" type="image/jpeg">
        <media:title>PoneyHot Logo - Tool gegen Fake News</media:title>
      </media:content>
      
      
      
      
      <dc:subject>Lesezeit: 3 Minuten</dc:subject>
      
      
      
      <dc:type>project</dc:type>
      
      
    </item><item>
      <title>Wie entwickelt man einen Amazon-Bot f√ºr Telegramm?</title>
      <link>http://localhost:1313/2018/2018-03-02-wie-entwickelt-man-einen-amazon-bot-fuer-telegramm/</link>
      <pubDate>Fri, 02 Mar 2018 00:00:00 +0000</pubDate>
      <author></author>
      <guid>http://localhost:1313/2018/2018-03-02-wie-entwickelt-man-einen-amazon-bot-fuer-telegramm/</guid>
      <description>Was ist ein Telegramm-Bot? Schon mal was von Telegramm geh√∂rt oder gar einem Telegramm-Bot geh√∂rt? Nein? Macht nichts. Telegramm ist ein Messenger, wie Whatsapp ‚Ä¶</description>
      
      
      <content:encoded>&lt;![CDATA[
        
        <div class="ai-summary">
          <h3>AI-Zusammenfassung</h3>
          <p>Diese umfassende Schritt-f√ºr-Schritt-Anleitung f√ºhrt durch die Entwicklung eines Telegram-Bots mit PHP, der die Amazon-Produktsuche integriert. Das Tutorial behandelt die Bot-Registrierung, die Einrichtung des PHP-Bot-Frameworks, die Anbindung an die Amazon Product Advertising API, die Integration von Analytics mit Botan und die Anonymisierung von Nutzerdaten, um einen voll funktionsf√§higen Amazon-Suchbot zu erstellen.</p>
          
          
          <p><strong>Hauptthemen:</strong> PHP, Telegram Bot, Amazon API, API Integration, Web Development, Chatbots, Bot Development, Analytics, Datenschutz</p>
          
          
          
          <p><strong>Schwierigkeitsgrad:</strong> advanced</p>
          
        </div>
        
        
        <h2 id="was-ist-ein-telegramm-bot">Was ist ein Telegramm-Bot?</h2>
<p>Schon mal was von Telegramm geh√∂rt oder gar einem Telegramm-Bot geh√∂rt? Nein? Macht nichts. Telegramm ist ein Messenger, wie Whatsapp oder Threema. Der gro√üe Vorteil von Telegramm gegen√ºber Whatsapp ist die Plattforum-Unabh√§ngigkeit. Es gibt nicht nur Apps f√ºr Android und iOs, auch unter OS X (Mac) und Windows l√§sst sich Telegramm unkompliziert nutzen. Bei Whatsapp war das bisher nur √ºber den Browser m√∂glich, Threema bietet diese M√∂glichkeit gar nicht an.</p>
<p>Au√üerdem bietet Telegramm ein sehr umfangreiche API an, die noch dazu sehr gut dokumentiert ist. Damit lassen sich sogenannte Telegramm-Bots entwickeln. Diese Bots k√∂nnen dann von den Nutzern mit @einBot angesprochen werden, um alle M√∂glichen Aufgaben auszuf√ºhren. Einer der bekanntesten ist vermutlich der @gif-Bot, der die Plattform¬†giphy.com durchsuchen kann und die Ergebnisse in den Chat-Verlauf schicken kann. Und diese Art von Bots lassen sich auch selber entwickeln und anbieten. Unter anderem auch mit PHP.</p>
<p>Wer die Kommunikation mit Telegramm nicht komplett von vorne aufbauen will, kann auf eine Bibliothek¬†<a href="https://github.com/php-telegram-bot/core">von Longman auf github.com</a>¬†zugreifen. F√ºr meinen Geschmack ist diese leider etwas zu schlecht dokumentiert und mitunter etwas durcheinander organisiert.¬†Noch dazu wird¬†sie offenbar nur sporadisch betreut. Dennoch gibt es ein relativ gro√ües Repository mit Beispielen, was definitiv sehr hilfreich¬† ist. Etwas verwirrend sind die beiden Repositories, die da <em>Core</em> und <em>Manager</em> hei√üen. Der <em>Manager</em> ist nur eine Art Wrapper f√ºr das Core-Repository. Dessen Nutzung erleichtert die Einrichtung und Entwicklung des Bots um ein vielfaches und bietet z.B. eine zentrale Datei (manager.php) an, um alle Funktionen zu steuern. Beim Core werden die jeweiligen Bot-Funktionen √ºber verschiedene Dateien gesteuert.</p>
<h3 id="was-ist-das-ziel">Was ist das Ziel?</h3>
<p>Was ist also der Plan? Wir bauen uns einen Telegramm-Bot, mit dem sich Amazon nach Produkten durchsuchen l√§sst. Das Ergebnis wird in einem Grid dargestellt. W√§hlt man ein Element aus, erscheint es mit Link zum Produkt im Chat-Verlauf. Und mit einer Analytics-Plattform soll das ganze</p>
<p>Um deinen eigenen Bot betreiben zu k√∂nnen brauchst du nat√ºrlich erstmal Telegramm und au√üerdem einen Web-Server und eine Domain f√ºr die du ein SSL-Zertifikat einrichten musst. Au√üerdem solltest du <a href="https://getcomposer.org/download/">composer</a> installiert haben und so ungef√§hr wissen, wie man damit umgeht.</p>
<h2 id="anmelden-eines-bots">Anmelden eines Bots</h2>
<p>Zun√§chst musst du deinen neuen Telegramm-Bot anmelden. Dazu nutzt du den BotFather (<a href="https://telegram.me/botfather">BotFather)</a>. dem du mit dem Befehl¬†/<em>newbot</em> dazu bringen kannst, einen neuen Bot zu registrieren. Zuerst wird ein Name f√ºr den Bot verlangt - das ist allerdings noch <em>nicht</em> der Name, mit dem der Bot sp√§ter auch angesprochen wird. Das ist erst der sogenannte <em>username</em>, der im 2. Schritt verlangt wird. Ich nenne meinen Bot <em>@buecherBot</em>.</p>
<p>Leider gibt es hier eine Restriktion: Der Name muss mit <em>bot</em> enden. Wer einen kurzen Namen wie @gif oder @youtube nutzen m√∂chte, muss dazu vermutlich etwas mehr Aufwand betreiben. Als n√§chstes rufst du die Einstellungen des Bots auf, indem du das Inline-Men√º mit /mybots √∂ffnest.</p>
<p>F√ºr unseren Bot solltest du zun√§chst den Inline-Mode aktivieren. Damit kannst du den Bot im Textfeld direkt ansprechen. Das gehst du √ºber den Punkt Bot-Settings zum Inline-Mode und aktivierst diesen.</p>
<p>[caption id=&ldquo;attachment_1655&rdquo; align=&ldquo;aligncenter&rdquo; width=&ldquo;300&rdquo;]<a href="https://www.nickyreinert.de/files/wie-entwickelt-man-einen-bot-fuer-telegramm/telegramm-bot-father.png"><img src="/2018/2018-03-02-wie-entwickelt-man-einen-amazon-bot-fuer-telegramm/images/telegramm-bot-father-300x200.png" alt="Inline-Mode f√ºr den Telegramm-Bot aktivieren"></a> Inline-Mode f√ºr den Telegramm-Bot aktivieren[/caption]</p>
<p>¬†</p>
<p>Schlie√ülich kannst du <em>Allow Groups</em> auf Nein setzen und die <em>Group Privacy</em> aktivieren. Da der Bot noch nicht in Gruppen aktiv sein soll, muss er weder Mitglied von Gruppen sein noch deren Nachrichten mitlesen.</p>
<p>Als n√§chstes l√§sst du dir den API-Schl√ºssel anzeigen, damit du auch von au√üen mit dem Bot kommunizieren kannst. Der API-Schl√ºssel befindet sich im obersten Men√º und ist folgenderma√üen aufgebaut:</p>
<p>123123123:128390123jKF19082_1293123123</p>
<p>Das war es, was die Vorbereitung angeht. Weiter geht es mit PHP und einer kleinen Bot-Logik.</p>
<h2 id="dem-bot-mit-php-leben-einhauchen">Dem Bot mit PHP Leben einhauchen</h2>
<p>Als Library bzw. Framework nutzen wir das¬†<a href="https://github.com/php-telegram-bot/core">Telegram-Bot-Repository</a> von Longman bzw. den dazugeh√∂rigen¬†<a href="https://github.com/php-telegram-bot/telegram-bot-manager">Manager</a>, eine Art Wrapper, der die Steuerung etwas erleichtert.Damit du f√ºr den ersten Start bereits eine gute Grundlage hast, solltest du dir <a href="https://github.com/php-telegram-bot/example-bot">die Beispiel-Dateien von github</a> herunterladen. Auf der github-Seite wird zwar die Einstellung f√ºr die composer.json vorgegeben, allerdings hat der checkout damit bei mir nicht funktioniert. Mit folgenden Parametern klappte es dann:</p>
<p>{
&ldquo;require&rdquo;: {
&ldquo;php-telegram-bot/telegram-bot-manager&rdquo;: &ldquo;^1.2&rdquo;,
&ldquo;longman/telegram-bot&rdquo;: &ldquo;0.52 as 0.48&rdquo;
}
}</p>
<p>Nachdem composer alle Abh√§ngigkeiten heruntergeladen hat (<em>composer install</em>), muss man sich in der manager.php an die Grundeinstellungen machen. (Es kann passieren, dass du auf deinem System einige PHP-Module installieren musst. Composer wird dir die Namen der Module allerdings nennen. Du kannst sie dann relativ unkompliziert mit z.B. apt-get install¬†php7.0-b_cmath¬†php7.0-curl herunterladen und aktivieren.) Au√üerdem werde ich ein paar √Ñnderungen an der Datei¬†InlinequeryCommand.php_ aus dem Ordner Commands aus dem Beispiel-Repository vornehmen.</p>
<p>Aber zuerst zur manager.php. Hier solltest du die folgenden Einstellungen vornehmen:</p>
<ul>
<li>
<p><strong>bot_username</strong> - der Benutzername deines Bots, ohne das f√ºhrende @</p>
</li>
<li>
<p><strong>api_key</strong> - der API-Schl√ºssel, den dir der Bot-Father gegeben hat</p>
</li>
<li>
<p><strong>secret</strong> - ein selbst erzeugtes Passwort um die Datei vor Zugriffen von au√üen zu sch√ºtzen - die PHP-Datei liegt ja auf deinem √∂ffentlichen Server und kann theoretisch von √ºberall aufgerufen werden.</p>
</li>
<li>
<p><strong>webhook-&gt;url</strong> - hier tr√§gst du die URL zur manager.php-Datei ein, also <a href="https://telegramm.example.com/manager.php">https://telegramm.example.com/manager.php</a></p>
</li>
<li>
<p><strong>commands-&gt;paths</strong> - diese Zeile muss auskommentiert sein und zu einem Pfad verweisen, der deine Bot-Commandos enth√§lt. Wenn du dich an dem Bot-Example orientierst, sieht diese Einstellung so aus:</p>
<pre><code>      'commands' =&gt; \[
         // Define all paths for your custom commands
         'paths'   =&gt; \[
             \_\_DIR\_\_ . '/Commands'
         \]
</code></pre>
</li>
</ul>
<p>Als n√§chstes kannst du noch ein paar zus√§tzliche √Ñnderungen vornehmen, die aber f√ºr die Funktion des Bots nicht wichtig sind:</p>
<ul>
<li><strong>max_connections</strong> - offensichtlich die Anzahl der maximal zul√§ssigen Verbindungen</li>
<li><strong>logging</strong> - diese Zeilen kannst du aus-kommentieren, um das Logging zu aktivieren, gerade in der Anfangsphase ist das ganz n√ºtzlich</li>
<li><strong>limiter</strong> - die Telegram-API l√§sst nat√ºrlich nur eine begrenzte Anzahl von Anfragen zu, um das eigene System zu sch√ºtzen, offenbar bringt das Framework eine Funktion mit, um das Erreichen des Limits bestm√∂glich zu vermeiden - wie das funktioniert, kann ich nicht sagen, da dazu auch nicht mehr in der Doku steht, ich hab es erstmal aktiviert</li>
</ul>
<p>Grunds√§tzlich war es das erstmal, was die Voreinstellungen betrifft. Jetzt kannst du den sog. webhook aktivieren. Dazu rufst du die manager.php im Browser auf, wie z.B.</p>
<p><a href="https://telegramm.example.com/manager.php">https://telegramm.example.com/manager.php</a></p>
<h3 id="den-zugriff-von-au√üen-beschr√§nken">Den Zugriff von au√üen beschr√§nken</h3>
<p>Wenn du alles richtig gemacht hast, erscheint jetzt erstmal ein Fehler. Und das ist auch gut so - denn schlie√ülich soll der Zugriff von au√üen ja nicht jedem gew√§hrt werden.</p>
<p>Fatal error: Uncaught TelegramBot\TelegramBotManager\Exception\InvalidAccessException:
Invalid access in &hellip;</p>
<p>Also packst du noch das secret-Token an die URL, dass du weiter oben in der manager.php angegeben hast (nicht den API-Schl√ºssel von Telegramm!). Und damit du auch eine Aktion ausl√∂st, setzt du erstmal den webhook mit dem Parameter a=set:</p>
<p><a href="https://telegramm.example.com/manager.php?s=123123123&amp;a=set">https://telegramm.example.com/manager.php?s=123123123&a=set</a></p>
<p>Dein Webhook f√ºr den Bot ist nun aktiv. Da du in der <em>manager.php</em> au√üerdem schon den Ordner commands freigegeben hast, kann der Bot nun schon auf Inline-Anfragen antworten. Im Telegramm-Client kannst du nun deinen Privat-Chat √∂ffnen (&ldquo;Gespeichertes&rdquo;) und den Telegramm-Bot mit @buecherBot ansprechen. Der Bot sollte nun, wenn alles korrekt eingerichtet, so antworten, wie es in der Datei¬†<em>InlinequeryCommand.php</em>¬†vorgegeben ist. N√§mlich mit einer sehr einfache 3-zeiligen Liste.</p>
<p>Um nun ein Ergebnis von der Amazon API als Bilder-Liste darzustellen, habe ich <em>InlinequeryCommand.php</em>¬†ein wenig angepasst. Zuerst ben√∂tigen wir die entsprechende Klasse, um nicht nur mit Text sondern auch mit Bildern zu antworten:</p>
<p>use Longman\TelegramBot\Entities\InlineQuery\InlineQueryResultPhoto;</p>
<p>Au√üerdem habe ich den Aufbau des Antwort-Objektes etwas vereinfacht (ich werde hier nicht weiter ins Detail gehen, auf $this-&gt;apiResult gehe ich sp√§ter ein).</p>
<p>foreach ($this-&gt;apiResult-&gt;items as $item) {</p>
<p>$this-&gt;inlineQueryResult[] = new InlineQueryResultPhoto(array(
&lsquo;id&rsquo;                    =&gt;  sizeof($this-&gt;inlineQueryResult),
&rsquo;title&rsquo;          	=&gt; &lsquo;Search: &rsquo; . $query,
&lsquo;description&rsquo;           =&gt; &lsquo;Info: &rsquo; . $information,
&rsquo;thumb_url&rsquo;             =&gt; $thumbUrl,
&lsquo;photo_url&rsquo;             =&gt; $imageUrl,
&lsquo;caption&rsquo;             	=&gt; $linkUrl
)
);</p>
<p>}</p>
<p>$data[&lsquo;results&rsquo;] = &lsquo;[&rsquo; . implode(&rsquo;,&rsquo;, $this-&gt;inlineQueryResult) . &lsquo;]&rsquo;;</p>
<p>return Request::answerInlineQuery($data);</p>
<p>Grunds√§tzlich war es das schon. Du kannst nun noch alle m√∂glichen anderen Funktionen des Bots nutzen. Schau dir dazu einfach den Commands-Ordner des Example-Repository an. Die Auswahl ist sehr gro√ü, f√ºr meine Zwecke soll es aber erstmal bei der Inline-Query bleiben.</p>
<h2 id="eine-suchanfrage-zu-amazon-schicken">Eine Suchanfrage zu Amazon schicken</h2>
<p>Nat√ºrlich soll derTelegramm-Bot nun auch in der Lage sein, Anfragen der Benutzer zu Amazon zu schicken und mit einem vern√ºnftigen Suchergebnis zu antworten. Zun√§chst ben√∂tigt man daf√ºr einen Partner-Account bei <a href="https://partnernet.amazon.de">Amazon</a>. <a href="https://partnernet.amazon.de/assoc_credentials/home">In den Einstellungen</a> kann man sich dann ein Schl√ºsselpaar erstellen um die Suchanfragen zu authentifizieren. Und auch f√ºr die Suchanfrage selber gibt es eine PHP-API, n√§mlich¬†<a href="https://github.com/Exeu/apai-io/">apai-io von exeu</a>. Die Einrichtung und der Aufbau sind relativ einfach. Nachdem composer die notwendigen Dateien heruntergeladen hat, packt man - wie √ºblich - ein paar Zeilen in eine PHP-Datei und hat die erste Anfrage an die Amazon-API fertig:</p>
<pre><code>&lt;?php ini\_set('display\_errors', 1);

require\_once \_\_DIR\_\_ . '/vendor/autoload.php';

define('AWS\_API\_KEY', 'AKAKAKAKAKAKAKA');
define('AWS\_API\_SECRET\_KEY', 'KALSKDLASKDLASDKLASDKLASKLDKASLDASDL
define('AWS\_ASSOCIATE\_TAG', 't0000-21');

use ApaiIO\\Configuration\\GenericConfiguration;
use ApaiIO\\Operations\\Search;
use ApaiIO\\ApaiIO;

$conf = new GenericConfiguration();
$client = new \\GuzzleHttp\\Client();
$request = new \\ApaiIO\\Request\\GuzzleRequest($client);

$conf
	-&gt;setCountry('de')
	-&gt;setAccessKey(AWS\_API\_KEY)
	-&gt;setSecretKey(AWS\_API\_SECRET\_KEY)
	-&gt;setAssociateTag(AWS\_ASSOCIATE\_TAG)
	-&gt;setRequest($request);
	
$apaiIO = new ApaiIO($conf);

$search = new Search();
$search-&gt;setCategory('DVD');
$search-&gt;setActor('Bruce Willis');
$search-&gt;setKeywords('Stirb Langsam');

$response = $apaiIO-&gt;runOperation($search);

$results = simplexml\_load\_string( $response ); 
</code></pre>
<p>Leider gestalten sich die ersten Versuche mit der API etwas schwieriger. Nutzt man den Beispiel-Code, liefert das ganze Script nur einen sehr langen String zur√ºck. In der weiterf√ºhrenden¬†<a href="http://apai-io.readthedocs.io/en/latest/chapters/responsetransformer.html">Dokumentation</a>¬†wird zwar ein <em>setResponseTransformer</em> beschrieben (siehe auskommentierte Zeile oben). Doch auch dann ist die Antwort nicht nutzbar. Das Suchergebnis bleibt weiterhin ein langer String. Erst <a href="https://github.com/Exeu/apai-io/issues/48">Issue 48</a> gibt einen Hinweis auf die L√∂sung: <em>new¬†SimpleXMLElement</em>.¬† Jetzt erhalte ich ein XML-Object, in dem ich mich mit einer Schleife durch das Ergebnis arbeiten kann. Oder man greift auf <a href="https://gist.github.com/ottanxyz/4a44a5094bf27606c12803590a92d131">die hier verwendete Funktion</a>¬†¬†<em>simplexml_load_string</em> zur√ºck - mein Favorit.</p>
<p>Nun geht es darum, die Antwort in eine Schleife zu packen, um die notwendigen Informationen zu extrahieren. Das Suchergebnis muss also vorbereitet und zur√ºck an denTelegramm-Bot geschickt werden.</p>
<h2 id="die-hochzeit---amazons-antwort-an-dentelegramm-bot-weiterleiten">Die Hochzeit - Amazons-Antwort an denTelegramm-Bot weiterleiten</h2>
<p>Bisher war die Amazon-Funktionalit√§t in eine andere Datei ausgelagert. Also m√ºssen erstmal Zugangsdaten und die Abh√§ngigkeiten in die InlineQueryCommand.php¬†√ºbernommen werden. Ich mach mir das Leben nicht unn√∂tig schwer, und packe das alles in die InlinequeryCommand.php. Sauberer w√§re es vielleicht, die initiale bot-Klasse etwas zu erweitern. Au√üerdem¬† muss die Anfrage an den Bot an die Amazon-API durchgeschliffen werden. Wenn der Benutzer nur einen Suchbegriff angibt (Bruce Willis), wird danach in allen Kategorien gesucht. Wer die Suche einschr√§nken m√∂chte, muss dem Suchbegriff die entsprechende Kategorie voranstellen. Also z.B.: Books:Bibel Das ganze sieht dann in etwa so aus:</p>
<p>$request = explode(&rsquo;:&rsquo;, trim($requestString));</p>
<p>if (sizeof($request) == 1) {</p>
<pre><code>$category = 'All';
$keywords = trim($request\[0\]);
</code></pre>
<p>} else {</p>
<pre><code>$category = trim($request\[0\]);
$keywords = trim($request\[1\]);
</code></pre>
<p>}</p>
<p>Kategorie und Keyword werden nun schlicht an die Amazon-API √ºbergeben. Damit ich auch Vorschaubilder erhalte, muss ich das in der Suche explizit angeben. Die Anfrage an die API sieht nun also so aus:</p>
<p>$search = new Search();
$search-&gt;setCategory($category);
$search-&gt;setKeywords($keywords);
$search-&gt;setResponseGroup( array( &lsquo;Images&rsquo;, &lsquo;ItemAttributes&rsquo; ) );	
$search-&gt;setPage(1);</p>
<p>Das ganze wird nun in ein Objekt gepackt und in einer Schleife durchlaufen um die Antwort f√ºr den Bot zu erzeugen. Das hat sich bei den ersten Versuchen als schwierig erwiesen. Es hat eine Weile gedauert, bis ich herausgefunden habe, dass ich die Eigenschaften des Antwort-Objekts als String casten muss: (string)!</p>
<p>foreach ($this-&gt;apiResult-&gt;Items-&gt;Item as $item) {</p>
<p>$title  = (string) $item-&gt;ItemAttributes-&gt;Title;
$url  = (string) $item-&gt;DetailPageURL;
$thumbFileUrl  = (string) $item-&gt;LargeImage-&gt;URL;
$thumbFileName = basename($thumbFileUrl);
$thumbFileType = pathinfo($thumbFileName, PATHINFO_EXTENSION);</p>
<p>if ($thumbFileType == &lsquo;jpg&rsquo; || $thumbFileType == &lsquo;jepg&rsquo;) {</p>
<pre><code>$this-&gt;inlineQueryResult\[\] = new InlineQueryResultPhoto(
array(
		'id'                    =&gt; sizeof($this-&gt;inlineQueryResult),
		'title'                 =&gt; $title,
		'description'           =&gt; $title,
		'caption'          		=&gt; $title@,
		'thumb\_url'             =&gt; $thumbFileUrl,
		'photo\_url'             =&gt; $thumbFileUrl,
		'input\_message\_content' =&gt; new InputTextMessageContent(\[
			'parse\_mode' =&gt; 'HTML',
			'message\_text' =&gt; ' ' . 'Shop it @ &lt;a href=&quot;'.$url.'&quot;&gt;Amazon&lt;/a&gt;!'\])
	)
);
</code></pre>
<p>}</p>
<p>if (sizeof($this-&gt;inlineQueryResult) &gt;= $this-&gt;limitResult) {</p>
<pre><code>break;
</code></pre>
<p>}</p>
<p>}</p>
<p>Grunds√§tzlich war es das. Das ganze Script gibt es zum Nachlesen wie gesagt auf github.</p>
<h2 id="zugriffsstatistiken-mit-botan-aufzeichnen-und-darstellen">Zugriffsstatistiken mit Botan aufzeichnen und darstellen</h2>
<p>Um Botan nutzen zu k√∂nnen, brauchst du einen Account bei <a href="https://appmetrica.yandex.com/">AppMetrica</a> von Yandex. Dort kannst du direkt nach der Registrierung einen API-Schl√ºssel f√ºr deinen Bot anlegen:</p>
<p>[caption id=&ldquo;attachment_1649&rdquo; align=&ldquo;aligncenter&rdquo; width=&ldquo;300&rdquo;]<a href="https://www.nickyreinert.de/files/wie-entwickelt-man-einen-bot-fuer-telegramm/appmetrics-yandex-bot-api-key-anlegen.png"><img src="/2018/2018-03-02-wie-entwickelt-man-einen-amazon-bot-fuer-telegramm/images/appmetrics-yandex-bot-api-key-anlegen-300x130.png" alt="AppMetrics API Key f√ºr Bot anlegen"></a> AppMetrics API Key f√ºr Bot anlegen[/caption]</p>
<p>Wenn das erledigt ist, gelangst du zu der √úbersichtsseite deines Bots und siehst dort den API-Key, den du als token in der <em>manager.php</em> eintr√§gst. Die entsprechenden Zeilen m√ºssen nat√ºrlich auch auskommentiert werden:</p>
<pre><code>    // Botan.io integration
    'botan' =&gt; \[
       'token' =&gt; '123123123-123123123-123123',
    \],
</code></pre>
<p>Das ist es schon fast gewesen. Wenn da nicht der Datenschutz w√§re. Wenn du Telegramm-Bot im Chat nun &ldquo;anrufst&rdquo;, erscheint der Aufruf einige Augenblicke sp√§ter auch im Interface von AppMetrics. Allerdings sind dann auch eine UserId und der Vorname im Klartext enthalten. Um das zu vermeiden, musst du Methode <em>track</em> in der Botan-Klasse (Botan.php in vendor\longman\telegram-bot\src\) anpassen:</p>
<p>Direkt an den Anfang der Methode habe ich die folgende Anonymisierung eingef√ºgt:</p>
<p>// ANONYMIZING STATS
if (isset($update-&gt;inline_query)) {</p>
<pre><code>if (isset($update-&gt;inline\_query\['from'\])) {

	if (isset($update-&gt;inline\_query\['from'\]\['id'\])) {
	
		$update-&gt;inline\_query\['from'\]\['id'\] = '0';
		$update-&gt;inline\_query\['from'\]\['first\_name'\] = 'anon';
		$update-&gt;raw\_data\['inline\_query'\]\['from'\]\['id'\] = '0';
		$update-&gt;raw\_data\['inline\_query'\]\['from'\]\['first\_name'\] = 'anon';
			
	}
}
</code></pre>
<p>}</p>
<p>Weiter unten wird eine UserId ($uid) ermittelt. Auch hier habe ich anonymisiert:</p>
<p>// In case there is no from field assign id = 0
// $uid = isset($data[&lsquo;from&rsquo;][&lsquo;id&rsquo;]) ? $data[&lsquo;from&rsquo;][&lsquo;id&rsquo;] : 0;
// ANONYMIZING STATS
$uid = 0;</p>
<p>Jetzt d√ºrften keine Klarnamen mehr √ºbermittelt werden und der Bot ist startklar.</p>
<p>¬†</p>
<p>Viel Spass mit deinem¬†Telegramm-Bot.</p>

        
        
        <div class="tags">
          <p><strong>Tags:</strong> php, telegram, bot, api, tutorial, amazon, Datenschutz</p>
        </div>
        
      ]]></content:encoded>
      
      
      
      <category>development</category>
      
      <category>anleitungen</category>
      
      
      
      
      <media:content url="http://localhost:1313/images/posts/placeholder.jpg" type="image/jpeg">
        <media:title>Wie entwickelt man einen Amazon-Bot f√ºr Telegramm? - Titelbild</media:title>
      </media:content>
      
      
      
      
      <dc:subject>Lesezeit: 5 Minuten</dc:subject>
      
      
      
      <dc:type>tutorial</dc:type>
      
      
    </item>
  </channel>
</rss>