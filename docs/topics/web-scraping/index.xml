<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" 
     xmlns:atom="http://www.w3.org/2005/Atom"
     xmlns:content="http://purl.org/rss/1.0/modules/content/"
     xmlns:dc="http://purl.org/dc/elements/1.1/"
     xmlns:media="http://search.yahoo.com/mrss/">
  <channel>
    <title>Web Scraping auf Nicky Reinert</title>
    <link>https://nickyreinert.de/topics/web-scraping/</link>
    <description>Blog &amp; Projekte von Nicky Reinert (Institut für digitale Herausforderungen): Webentwicklung &amp; Software Development, SEO &amp; Analytics, Hosting &amp; DevOps, WordPress &amp; Hugo, Tools &amp; Projekte, Datenschutz und digitale Kultur – plus Texte zu KI sowie Autismus &amp; Gesellschaft.</description>
    <generator>Hugo 0.148.2</generator>
    <language>de</language>
    <managingEditor></managingEditor>
    <webMaster></webMaster>
    <copyright></copyright>
    <lastBuildDate>Thu, 21 Jan 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://nickyreinert.de/topics/web-scraping/index.xml" rel="self" type="application/rss+xml" /><item>
      <title>Augenblicke - Eine statistische Analyse des Flirt-Portals der BVG</title>
      <link>https://nickyreinert.de/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/</link>
      <pubDate>Thu, 21 Jan 2021 00:00:00 +0000</pubDate>
      <author></author>
      <guid>https://nickyreinert.de/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/</guid>
      <description>Was ist &ldquo;Augenblicke&rdquo;? Im Frühjahr 2006, mehr als 6 Jahre bevor Tinder die Herzen der Smarthphone-Besitzer im Sturm eroberte, startete die BVG auf …</description>
      
      
      <content:encoded>&lt;![CDATA[
        
        <div class="ai-summary">
          <h3>AI-Zusammenfassung</h3>
          <p>Dieser Artikel präsentiert eine statistische Analyse von &#39;Augenblicke&#39;, dem Flirt-Portal der Berliner Verkehrsbetriebe (BVG). Er untersucht die Entwicklung der Beitragszahlen, die Nutzung verschiedener Linien und Verkehrsmittel, die Popularität von Pseudonymen sowie zeitliche Muster und die Stimmung der Nachrichten. Zudem werden die Methodik der Datenerfassung und mögliche Fehlerquellen detailliert beleuchtet.</p>
          
          
          <p><strong>Hauptthemen:</strong> Datenanalyse, Statistik, BVG, Berlin, Öffentlicher Nahverkehr, Flirt-Portale, Web Scraping, NLP, Sentiment Analyse</p>
          
          
          
          <p><strong>Schwierigkeitsgrad:</strong> advanced</p>
          
        </div>
        
        
        <h2 id="was-ist-augenblicke">Was ist &ldquo;Augenblicke&rdquo;?</h2>
<p>Im Frühjahr 2006, mehr als 6 Jahre bevor <strong>Tinder</strong> die Herzen der Smarthphone-Besitzer im Sturm eroberte, startete die BVG <a href="https://www.bvg.de/de/Meine-BVG/Meine-Augenblicke/Alle-Augenblicke">auf ihrer Seite ein Portal mit dem Namen &ldquo;<strong>Augenblicke</strong>&rdquo;</a>. Im Gegensatz zu Tinder sind sich die Nutzer von <em>Augenblicke</em> in der Regel aber ziemlich sicher schon einmal über den Weg gelaufen - nämlich in einer der zahlreichen Fahrzeuge der BVG oder S-Bahn.</p>
<p><em><strong>Augenblicke</strong></em> will diese verlorenen Seelen nun zusammenbringen. Wer beim ersten Treffen nicht den Mut aufgebracht hat, das Gegenüber anzusprechen, darf das später mit einer Nachricht auf dem Portal nachholen. Das geschieht unter der Angabe eines <strong>Pseudonyms</strong>, <strong>ein paar Zeilen Text</strong>, <strong>der Tram-, Bus- oder Bahn-Linie</strong> und natürlich dem <strong>Zeitpunkt</strong>, wann man sich über den Weg gelaufen ist - der sogenannte und namensgebende <strong>Augenblick</strong>. Das Prinzip ist also recht einfach. Nach einem verhaltenen Start Anfang 2006 dauerte es erstmal einige Zeit, bis sich ein gewisser Erfolg zeigte.</p>
<p><em>(Hinweise zur Methodik und Fehlerquellen am Ende)</em></p>
<h2 id="kleinermannmitbart">KleinerMannMitBart</h2>
<p><a href="https://www.bvg.de/de/Meine-BVG/Meine-Augenblicke/Alle-Augenblicke?act=read-moment&amp;id=2846">Zum allerersten Augenblick</a> kam es an einem <strong>Valentinstag</strong>: Am 14. Februar 2006 um 5 Uhr traf es <strong>KleinerMannMitBart</strong> in der <strong>Buslinie 284</strong>:</p>
<blockquote>
<p>&ldquo;Du (blond, grüne Augen, schlank)&rdquo;</p>
<p>KleinerMannMitBart, 14. Februar 2006</p></blockquote>
<p>Der Dienst dümpelte dann eine Weile vor sich hin, bevor er in der Öffentlichkeit nachhaltig wahrgenommen wird. Erst in 2007 nahm das Portal tatsächlich <em>fahrt</em> auf: die monatliche Beitragszahl stieg auf über 100. Der vorläufige Höhepunkt wurde <strong>im Mai 2018 mit 291 Beiträgen</strong> im Monat erreicht, fast 10 Gesuche pro Tag! Doch dann war der Hype schon wieder vorbei, das <strong>Ende der fetten Flirtjahre</strong>:</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-21.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-21-700x435.png" alt=""></a></p>
<p>Anzahl Beiträge / Jahr nach Anbieter</p>
<p>Der Abwärtstrend ist insofern überraschend, da die Zahl der tatsächlichen Fahrgäste in den letzten Jahren stetig zunimmt.</p>
<p>Bis Januar 2021 haben die Besucher in 240 verschiedenen <strong>Linien der BVG, S-Bahn und sogar Deutschen Bahn (Regio!)</strong> <strong>genau 20.108 Augenblicke</strong> erlebt. Zu den meisten Begegnungen kommt es den <strong>U-Bahnen und S-Bahnen</strong>:</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-2.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-2-700x367.png" alt=""></a></p>
<p>Wenn man etwas mehr ins Detail geht, zeigt sich, dass die <strong>U-Bahn</strong> mit <strong>8.149 Einträgen</strong> leicht vorne liegt, dicht gefolgt von der <strong>S-Bahn</strong> (<strong>6.581</strong>)</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-3.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-3-700x803.png" alt=""></a></p>
<p>Für dieses Ranking kann es übrigens drei Erklärungen geben:</p>
<ol>
<li>Entweder gibt es mehr Singles, die bevorzugt die U-Bahn benutzen, oder</li>
<li>die Fahrt unter der Erde ermutigt die Menschen eher zum Flirten.</li>
<li>Oder die Menschen sind in der U-Bahn besonders schüchtern und müssen daher vermehrt auf dieses Portal zurückgreifen.</li>
</ol>
<h2 id="trakl-und-2151-anonyme">Trakl und 2.151 Anonyme</h2>
<blockquote>
<p>[&hellip;]
Ihr Lächeln, mal amüsiert, gelegentlich auch erstaunt, aber immer von feinster Anmut - ach, es macht(e)mich zufrieden. Nun, die hellen Tage [&hellip;]</p>
<p>Takl am 21. März 2011 in der M1</p></blockquote>
<p><em>Trakl</em> ist nicht nur der Name eines expressionistischen Dichters aus Österreich. Der Name taucht auch auf der Plattform auf und ist mit <strong>39 Einträgen</strong> das am meisten genutzte <strong>Synonym</strong>. Insgesamt wurden <strong>12.298 verschiedene Pseudonyme</strong> genutzt. <strong>2.151 Benutzer</strong> <strong>haben keinen Namen</strong> angeben. Das ist die Top-10 der beliebtesten Namen auf dem Portal:</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-4.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-4-700x210.png" alt=""></a></p>
<p>Schaut man sich an, auf welchen Linien <em>die Autoren:innen</em> unterwegs waren, kommt schnell der Verdacht auf, dass es sich jeweils um ein und dieselbe Personen handelt.</p>
<p>Natürlich lässt der Datensatz auch Rückschlüsse auf die <strong>genau Uhrzeit</strong> oder die <strong>exakte</strong> <strong>Linienbezeichnung</strong> und damit vermutlich sogar eine <strong>Pendelstrecke</strong> zu. <em>Aus Gründen</em> möchte ich diese Details hier nicht weiter vertiefen.</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-6.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-6-700x184.png" alt=""></a></p>
<h2 id="tageszeiten-und-wochentage">Tageszeiten und Wochentage</h2>
<p>Zurück zur grauen Masse und der Frage: <strong>Zu welcher Tageszeit</strong> und an welchem Wochentag sind die Portal-Nutzer am aktivsten? Zunächst zum offensichtlichen: Die Pendlerzeiten liegen zwischen 7 und 9 Uhr sowie 16 und 19 Uhr. An den Werktagen zeigt sich, dass die Bereitschaft zu Flirten am müden Morgen noch relativ gering ist. Abends, zum Feierabendverkehr - kommt es dagegen zu sehr vielen Kontakten.</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-7.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-7-700x768.png" alt=""></a></p>
<p>Beiträge je Wochentag und Tageszeit</p>
<p>Wenig überraschend sieht es am Wochenende etwas anders aus. Hier verlagert sich die Anzahl der Einträge zunächst auf den frühen Nachmittag.</p>
<p>Ein kurzer Blick auf die Stimmung der Beiträge: Eine klare Tendenz lässt sich hier nicht erkennen. In den frühen Morgenstunden scheint die Stimmung stärker zu schwanken als Abends.</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-9.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-9-700x771.png" alt=""></a></p>
<p>Stimmung im Wochenverlauf (-1: negativ, 1: positiv)</p>
<h2 id="textanalyse">Textanalyse</h2>
<p>Zunächst ein grober Überblick über die Stimmung im Verlauf der Jahre sowie die durchschnittliche Länge der Beiträge und Wortanzahl.</p>
<p>Die Wortlänge über alle Nachrichten hat sich im Laufe der Jahre kaum verändert. Die Ausschläge zu Beginn der Messung sind auf die geringe Fallzahl zurückzuführen. Danach sind es zwischen 70 und 80 Wörter pro Nachricht. Ab Ende 2014 gibt es einen kurzlebigen Aufwärtstrend in Richtung 90 Wörter pro Eintrag.</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-10.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-10-700x364.png" alt=""></a></p>
<p>Zwischen 2011 und 2014 lässt sich ein kleines Stimmungstief erkennen. In 2020 gibt es noch mal einen deutlichen Knick - Auswirkungen von Corona? Auch die (durchschnittliche) Länge der Nachrichten und die Wortanzahl scheint ab 2015 leicht zu steigen.</p>
<p>Die nächste Abbildung zeigt die Stimmung aller Autoren:innen sowie die Objektivität ihrer Nachrichten. Die Objektivität liefert kaum Erkenntnisgewinn und wird hier nur einmal erwähnt. Interesssanter ist die Stimmung, die in den allermeisten Fällen positiv ist, mitunter sogar stark positiv.</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-11.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-11-700x435.png" alt=""></a></p>
<p>Stimmung und Objektivität aller Autoren</p>
<p>Weiter geht es mit der Stimmung nach Fahrzeugklasse. Die Abbildung zeigt neben der Stimmung auch die Anzahl der Beiträge (blaue Punkte). So dürfte sich die relativ hohe mittlere Stimmung bei den Nachtbussen erklären. Insgesamt lässt sich vielleicht festhalten, dass die Stimmung in den S- und U-Bahnen sowie Regionalzügen am geringsten ist.</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-13.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-13-700x562.png" alt=""></a></p>
<p>Das passt zu der Erkenntnis oben, dass Beiträge mit Bezug zu z.B. Bussen vergleichsweise selten vorkomen: <strong>Sind die Menschen dort glücklicher und demnach vor Ort kontaktfreudiger</strong>?</p>
<p>Die <strong>längsten Nachrichten</strong> mit den <strong>meisten Wörtern</strong> kommen übrigens nicht aus den Linien-Favoriten S-Bahn oder U-Bahn. Nein, es sind Regionalbahnen und die Nacht-Busse, die sich offenbar äußerst fruchtbar auf die Fantasie der Fahrgäste auswirken. Eine Erklärung: Hat man hier mehr Zeit zum Schreiben?</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-15.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-15-700x463.png" alt=""></a></p>
<p>Noch mal zurück zur Auswertung der Stimmung. Für das folgende Histogramm habe ich die Stimmungswerte in 0,05 Schritten geclustert um deutlich zu machen, in welchem Bereichen sich die Stimmung der meisten Nachrichten bevorzugt zeigt. Hier ist ganz klar eine Dominanz im neutralen Bereich (0) bis hin zu mittelmäßig positiv (0,5) zu erkennen.</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-16.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-16-700x454.png" alt=""></a></p>
<p>Lässt man sich die Cluster im Tagesverlauf anzeigen, dass die Stimmung fast gleichmäßig verteilt zu sein scheint. Nur am Freitag gibt es im Bereich um 0,2 eine höhere Konzentration an Nachrichten (je dunkler die Farbe, desto mehr Nachrichten in diesem Cluster):</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-18.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-18-700x556.png" alt=""></a></p>
<h2 id="phrasen-und-wörter">Phrasen und Wörter</h2>
<p>Zum Abschluss noch ein kleiner Blick auf beliebte Phrasen und Wörter. Zunächst alle Wörter (die mindestens 1.000 mal gezählt wurden):</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-19.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-19-700x285.png" alt=""></a></p>
<p>Wenig überraschend sind hier beschreibende Wörter wie <strong>Auge, Haar, Jacke</strong>, <strong>Braune</strong>, <strong>Rucksack</strong> oder <strong>Mantel</strong> zu finden. Interessant auch: Das Wort <strong>leider</strong> wird über <strong>6.000</strong> mal verwendet. Nachvollziehbar: Die Plattform ist ja eine Anlaufstelle, für verpasste Chancen. Das absolut häufigste Wort ist <strong>haben</strong> mit über 22.000 Vorkommen. Zur Erklärung: Da die Wortstämme gezählt werden, fallen darunter auch <strong>hat, hast, habe</strong> usw. Sprich: <strong>Ich habe dich gesehen, hast du mich gesehen</strong>.</p>
<p>Nun noch ein kurzer Blick auf die beliebtesten Phrasen:</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/grafik-20.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/grafik-20-700x315.png" alt=""></a></p>
<p>Sehr schön gefällt mir hier das Vorkommen von &ldquo;<strong>unsere Blicke</strong>&rdquo; - was sich nicht nur wunderbar auf den Namen des Portals - Augenblicke - sondern auch seinen Zweck beziehen lässts. Ansonsten finden sich hier natürlich auch naheliegende, beschreibende Phrasen. Es geht ja um die &ldquo;Personensuche&rdquo;: <strong>Blonde Haare, dein Lächeln, schwarze Jacke</strong>.</p>
<h2 id="methodik-und-fehlerquellen">Methodik und Fehlerquellen</h2>
<h3 id="datenerfassung-und-grobes-datenmodell">Datenerfassung und grobes Datenmodell</h3>
<p>Um die Beiträge <a href="https://www.bvg.de/de/Meine-BVG/Meine-Augenblicke/Alle-Augenblicke">von der Hauptseite</a> abzugreifen, nutze ich ein in <strong>PHP</strong> geschriebenes Script (<a href="https://github.com/nickyreinert/crawl-augenblicke">crawl-augenblicke auf Github</a>). In einer <strong>MySQL</strong>-Tabelle speichere ich dann den <strong>Titel der Nachricht</strong>, den <strong>Nachrichten-Text</strong>, den <strong>Verfasser der Nachricht</strong>, das <strong>Datum</strong> an dem die Nachricht verfasst wurde sowie das <strong>Datum, an dem der &ldquo;Augenblick&rdquo; stattgefunden</strong> hat. Dazu wird die <strong>URL</strong> zum Beitrag sowie die <strong>Linie</strong> erfasst. Zusätzlich nutze ich einige selbstgeschriebene <strong>MySQL-Funktionen</strong>, um die <strong>Anzahl der Wörter im Titel</strong> und dem <strong>Nachrichten-Text</strong> sowie die <strong>Differenz zwischen den beiden Zeitpunkten</strong> zu erfassen. Ein paar eigene Views erleichtern das anfängliche Finden von Fehlern.</p>
<p>Daneben gibt es zwei weitere Tabellen mit Meta-Informationen. Dies ist zunächst eine <strong>Blacklist</strong>-Tabelle, die bei einer Aggregation der Wort-Häufigkeiten ignoriert werden sollen. Das betrifft nicht den Vorgang des Zählens der Wörter! In einer weiteren Tabelle wird eine <strong>Zuordnung der Linien</strong> zu den Linientypen sowie Subtypen festgehalten. Zu den Linientypen zählen nur Bus, Tram, Zug sowie Fähre. Anhand der Subtypen kann außerdem in besondere Liniengruppen unterschieden werden, wie z.B. Metro-Bus, Express-Bus usw.</p>
<p><a href="https://www.nickyreinert.de/files/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/datenbankschema.png"><img src="/2021/2021-01-21-augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/images/datenbankschema-300x182.png" alt="Datenbankschema"></a></p>
<p>Datenbankschema</p>
<p>Mit einem <strong>Python-Script</strong> lese ich den Datensatz ein und bereinige die Texte. Stoppwörter werden aussortiert, Steuerzeichen, HTML-Entitites und andere Störquellen werden entfernt. Dann berechen ich für jedes Wort die <strong>IDF</strong> (<strong>Inverse Document Frequency</strong>) nach der Formel <strong>log 1 + (doc_count_total / doc count with word occurrence</strong>). Für die NLP-Aufgaben nutze ich das NLTK bzw. den <strong>HannoverTagger</strong> (<a href="https://nickyreinert.de/blog/2020/12/09/einfuehrung-in-stemming-und-lemmatisierung-deutscher-texte-mit-python/">siehe auch</a>). Für die Erkennung der Phrasen und der Stimmung nutze ich <strong>TextBlob</strong> mit deutschen <a href="https://github.com/markuskiller/textblob-de">Trainingsdaten von hier</a>.</p>
<h3 id="mögliche-fehlerquellen">Mögliche Fehlerquellen</h3>
<p>Grundsätzlich gibt es zwei Dinge zu beobachten: Die Auswertungen werden nicht in Relation zur tatsächlichen Anzahl der Fahrgäste der jeweiligen Linie betrachtet, da diese nur auf Jahresebene zu Verfügung stehen. Es kann also nur ein Vergleich der absoluten Zahlen stattfinden. In Relation betrachtet kann die Gegenüberstellung der Linien ein anderes Ergebnis liefern.</p>
<p>Außerdem kann die Anzahl der Einträge je Linie auf zwei Arten interpretiert werden: Die Passagiere sind in der Linie mit vielen Einträgen entsprechend flirtfreudiger und offener und deshalb kommt es auf der Plattform zu mehr Gesuchen. Oder aber es ist genau andersrum: Da die Menschen einer bestimmten Linie schüchterner sind, trauen sie sich erst im Nachhinein die Kontaktaufnahme über diese Plattform zu starten. Diese Erkenntnisse müssen also mit Vorsicht betrachtet werden.</p>
<p>Leider gab es im Laufe der Zeit einige technische Anpassungen auf den Seiten der BVG, die einige Analysen etwas erschweren bzw. verhindern. Das betrifft vor allem das Datum, an dem die Beiträge verfasst (<strong>date_posted</strong>) wurden. Es fällt auf, dass sehr viele Einträge offenbar am 13. August 2014 verfasst wurden, das Datum des Augenblicks (<strong>date_met</strong>) aber sehr lange zurück liegt, teilweise bis 2006. Das älteste Datum in date_posted ist der 30.06.2014, bei date_met allerdings der 14.02.2006. Die Vermutung ist also, dass das Datum, an dem der Beitrag verfasst wurde, erst ab Juni 2014 mit erfasst wurde. Im August hat man dann vermutlich alle älteren Beiträge auf das feste Datum, nämlich den 13.08.2014 gesetzt. Insgesamt betrifft das immerhin 15.560 Datensätze.</p>
<p>Die Stimmungsanalyse nutzt einen fertigen Trainingsdatensatz und ist nur so gut, wie die Qualität der Texte.</p>
<h2 id="verwendete-technologie">Verwendete Technologie</h2>
<p>Für das Abgreifen des BVG-Portals verwende ich ein <a href="https://github.com/nickyreinert/crawl-augenblicke">PHP-Script</a>. Das Python-Script zur Normalisierung, Anreicherung und Bereinigung der Daten ist nicht öffentlich. Ganz offensichtlich verwende ich Wordpress. In einer früheren Variante habe ich zwei selbstgeschriebene Plugins verwendet. Das ist zum einen das Plugin für die Darstellung der <a href="https://github.com/nickyreinert/data-heatmap">HTML-Heatmap</a> sowie das Plugin für die <a href="https://github.com/nickyreinert/wordCloud-for-Wordpress">WordCloud</a>, basierend auf dem fantastischen wordCloud2.js von Tim Dream. Die Idee war, die Zahlen dynamisch zu aktualisieren. Mittlerweile bin ich auf einfache Screenshots von Tableau Public umgestiegen.</p>

        
        
        <div class="tags">
          <p><strong>Tags:</strong> analyse, augenblicke, berlin, bvg, oepnv, statistik, tinder, Berlin</p>
        </div>
        
      ]]></content:encoded>
      
      
      
      <category>projekte</category>
      
      
      
      
      <media:content url="https://nickyreinert.de/images/posts/placeholder.jpg" type="image/jpeg">
        <media:title>Augenblicke - Eine statistische Analyse des Flirt-Portals der BVG - Titelbild</media:title>
      </media:content>
      
      
      
      
      <dc:subject>Lesezeit: 5 Minuten</dc:subject>
      
      
      
      <dc:type>data_analysis</dc:type>
      
      
    </item><item>
      <title>Fefes Blog - Eine Analyse</title>
      <link>https://nickyreinert.de/2019/2019-11-05-fefes-blog-eine-analyse/</link>
      <pubDate>Tue, 05 Nov 2019 00:00:00 +0000</pubDate>
      <author></author>
      <guid>https://nickyreinert.de/2019/2019-11-05-fefes-blog-eine-analyse/</guid>
      <description>Nach der gar nicht mal so großen öffentlichen Wahrnehmung meiner laienhaften statistischen Analyse des Flirtportals der BVG &ldquo;Augenblicke&rdquo;, habe ich …</description>
      
      
      <content:encoded>&lt;![CDATA[
        
        <div class="ai-summary">
          <h3>AI-Zusammenfassung</h3>
          <p>Dieser Artikel bietet eine statistische Analyse von Fefes Blog, einem bekannten deutschen IT-Sicherheits- und Politik-Blog. Er untersucht die Entwicklung der Beitragsfrequenz, die Häufigkeit von Wörtern und externen Quellen, sowie die Blog-Zeiten. Zudem werden technische Aspekte des Web Scrapings und die Interpretation des Blog-eigenen Zeitstempelformats beleuchtet.</p>
          
          
          <p><strong>Hauptthemen:</strong> Web Analyse, Datenanalyse, Blog Analyse, Web Scraping, Python, Tableau, IT Sicherheit, Fefes Blog, Statistik</p>
          
          
          
          <p><strong>Schwierigkeitsgrad:</strong> advanced</p>
          
        </div>
        
        
        <p>Nach der gar nicht mal so großen öffentlichen Wahrnehmung meiner laienhaften <a href="https://www.nickyreinert.de/augenblicke-eine-statistische-analyse-des-flirt-portals-der-bvg/">statistischen Analyse des Flirtportals der BVG &ldquo;Augenblicke&rdquo;</a>, habe ich mich mal einem anderem Projekt gewidmet. Es geht um <a href="http://blog.fefe.de">Fefes Blog</a>, einer meiner ersten Anlaufstellen, wenn ich mir die tägliche Nachrichtendosis gebe. Inspiriert wurde ich dazu durch eine <a href="https://www.netaction.de/datenvisualisierung-von-fefes-blogzeiten/">Analyse der Blogzeiten von Fefe</a>, die allerdings schon acht Jahre zurück liegt.<br>
Für meine Analyse des BVG-Portal hatte ich damals noch PHP gewählt, um die Seiten auszulesen und in eine Datenbank zu hauen. Das war ziemlich aufwendig. Diesmal wollte ich es mit Python probieren und damit auch gleich mein erstes Projekt in dieser Sprache realisieren (der Quellcode steht <a href="https://github.com/nickyreinert/fefeScrape">auf Github</a> zur Verfügung).</p>
<p>Die ersten Schritte mit Python waren etwas holprig. Mit der Zeit zeigt sich aber, dass das Scraping hier weitaus bequemer ist als mit PHP. Außerdem ist Fefes Blog eine ziemlich angenehme Datenquelle, da Fefe seit Anbeginn auf eine wirklich saubere und konsistente Seitenstruktur setzt. Pures HTML. Es ist ein Traum. Danke, Fefe. Ein paar Hintergründe zur Datenerfassung gibt es am Ende.</p>
<h2 id="auswertung">Auswertung</h2>
<p>Insgesamt habe ich 43.908 Einträge im Zeitraum von Ende März 2005 bis Anfang November 2019 ausgewertet. Nach meiner Zählung hat Fefe einen sehr reichen Wortschatz: ich konnte 141.048 verschiedene &ldquo;Wörter&rdquo; ausfindig machen. Außerdem verweißt Fefe auf 8.862 externe Quellen. Auf sich selber hat Fefe innerhalb des Zeitraums 2.661 mal verlinkt. Auch wenn Fefe den Spiegel oft als &ldquo;ehemaliges Nachrichtenmagazin&rdquo; bezeichnet: Der Spiegel ist mit 4.447 Verlinkungen die meist genutzt Quelle, gefolgt von heise.de (3.252). Man muss aber auch eingestehen, dass die Verlinkung zum Spiegel seit 2010 stark abnimmt.</p>
<p><a href="/2019/2019-11-05-fefes-blog-eine-analyse/images/fefe_words-1.png"><img src="/2019/2019-11-05-fefes-blog-eine-analyse/images/fefe_words-1-700x339.png" alt="Fefes Quellen - Spiegel Online, Heise und… er selbst ;)"></a></p>
<p>Fefes Quellen - Spiegel Online, Heise und&hellip; er selbst ;)</p>
<p>Insgesamt kann man einen Abwärtstrend der Nachrichtenfrequenz bei Fefe feststellen. Seinen Höhepunkt hatte Fefe gleich zu Beginn: Im Juli 2005 gab es 528 Einträge. Den zweiten Höhepunkt erreichte Fefes Blog knapp 10 Jahre später. Im April 2015 gab es 440 Einträge. Ansonsten zeigt der Trend leider nach unten. Im Schnitt gibt es jeden Monat 244 Beiträge (Median 238). Für November 2019 sagt das Prognosemodul von Tableau übrigens 182 Einträge voraus.</p>
<p><a href="/2019/2019-11-05-fefes-blog-eine-analyse/images/monthly.png"><img src="/2019/2019-11-05-fefes-blog-eine-analyse/images/monthly-700x361.png" alt="Anzahl der Einträge pro Monat im Jahresverlauf"></a></p>
<p>Anzahl der Einträge pro Monat im Jahresverlauf</p>
<p><a href="/2019/2019-11-05-fefes-blog-eine-analyse/images/blogging-times.png"><img src="/2019/2019-11-05-fefes-blog-eine-analyse/images/blogging-times-62x300.png" alt="Anzahl der Nachrichten je Tageszeit im Jahresverlauf"></a></p>
<p>Anzahl der Nachrichten je Tageszeit im Jahresverlauf</p>
<p>In Anlehnung an mein Vorbild, habe ich mir natürlich auch angeschaut, zu welcher Tagszeit Fefe aktiv ist. Zunächst erkennt man, dass Fefe bevorzugt nachmittags aktiv ist. Aber scheinbar gibt es auch hier saisonale Unterschiede. So ist er im Januar bis Juli 2006, den März ausgeschlossen, eher ab 17 Uhr aktiv, danach aber wieder über den ganzen Tag verteilt (Nachtstunden ausgeschlossen). Im April und Mai 2007 konzentrieren sich die Nachrichten wieder auf den späten Nachmittag. In den folgenden Jahren, bis 2015, sind es immer wieder die Frühsommer / Frühlingsmonate, in denen sich die Beiträge zu dieser Tageszeit konzentrieren. Entweder ist Fefe ist ein ausgesprochener Frühlingsmensch. Eine andere Erklärung sind Projekte, die in diesen Monaten stattfinden und ein Bloggen erst zum Nachmittag zulassen. Denkbar ist auch, dass Fefe aufgrund seiner (zyklischen?) Reisetätigkeit und dem damit verbundenen Zeitzonenwechsel zu unterschiedlichen Zeiten bloggt.</p>
<p>Kreuzt man den Wochentag mit der Tageszeit, zeigt sich, wann Fefe die meisten Beiträge absetzt. Mittwochs um 17 Uhr. Das Wochenende ist Fefe heilig, die Beitragsfrequenz ist hier sehr niedrig. Auch zu den typischen Nachtzeiten gibt es nur sehr wenige Einträge. Hier gibt es öfter auffällige Konzentrationen, wie z.B. im Frühling 2015, die ich auch auf Zeitzonenwechsel - sprich Reisen - schiebe.</p>
<p><a href="/2019/2019-11-05-fefes-blog-eine-analyse/images/wochentag-x-uhrzeit-nachrichten-1.png"><img src="/2019/2019-11-05-fefes-blog-eine-analyse/images/wochentag-x-uhrzeit-nachrichten-1.png" alt="Anzahl der Nachrichten je Wochentag und Tageszeit"></a></p>
<p>Anzahl der Nachrichten je Wochentag und Tageszeit</p>
<p>Die längsten Nachrichten entstehen übrigens zur Nachtzeit (oder je nach Sichtweise, während den Reisen in andere Zeitzonen). Montags, um 5 Uhr, ist die durchschnittliche Wortzahl am höchsten. Der Median weist dazu übrigens den Sonntag um 2 Uhr nachts aus.</p>
<ul>
<li>
<p><a href="/2019/2019-11-05-fefes-blog-eine-analyse/images/wochentag-x-uhrzeit-wortzahl-avg-1.png"><img src="/2019/2019-11-05-fefes-blog-eine-analyse/images/wochentag-x-uhrzeit-wortzahl-avg-1.png" alt=""></a></p>
<p>Wortanzahl (Mittelwert) je Wochentag und Tageszeit</p>
</li>
<li>
<p><a href="/2019/2019-11-05-fefes-blog-eine-analyse/images/wochentag-x-uhrzeit-wortzahl-median-1.png"><img src="/2019/2019-11-05-fefes-blog-eine-analyse/images/wochentag-x-uhrzeit-wortzahl-median-1.png" alt=""></a></p>
<p>Wortanzahl (Median) je Wochentag und Tageszeit</p>
</li>
</ul>
<p>Eine Wortwolke, analog der Wolke der externen Quellen, ist aufgrund der schieren Menge etwas zu aufwendig und hätte auch nur wenig Informationsgehalt, weshalb ich darauf mal verzichte. Hier nur eine Darstellung der häufigsten Wörter, weil es so schön aussieht:</p>
<p><a href="/2019/2019-11-05-fefes-blog-eine-analyse/images/woerter.png"><img src="/2019/2019-11-05-fefes-blog-eine-analyse/images/woerter-700x387.png" alt="Spektakuläre Topliste der verwendeten Wörter"></a></p>
<p>Spektakuläre Topliste der verwendeten Wörter</p>
<p>Was ich allerdings liefern kann, ist eine Liste der Fefe-Kunstwörter, wie z.B. &ldquo;<a href="https://blog.fefe.de/?ts=a27615a6">Notfall-Soforthilfe-Klopapier&rdquo;</a>. Das längste dieser Art ist &ldquo;<a href="https://blog.fefe.de/?ts=b293636b">Webforen-Besserwisser-Klugscheißer-Korinthenkacker-Sockenpuppen-Grabenkriegen&rdquo;</a>. Das folgende Diagramm zeigt die Top 33 der Fef&rsquo;schen Wortschöpfungen:</p>
<p><a href="/2019/2019-11-05-fefes-blog-eine-analyse/images/grafik.png"><img src="/2019/2019-11-05-fefes-blog-eine-analyse/images/grafik-700x368.png" alt="Fefes Wortschöpfungen Top 33"></a></p>
<p>Fefes Wortschöpfungen Top 33</p>
<p>Kommen wir zu den Verweisen auf externe Quellen. Der Spiegel (Online) gehört wie gesagt zu den favorisierten Quellen von Fefe. Ansonsten ist Fefe nicht wählerisch, was Quellen angeht. Die Auswahl ist immens. Interessant ist, wie z.B. <em>Twitter</em> seit 2009 immer öfter zu den verlinkten Quellen gehört. Auf <em>The Guardian</em> hingegen wurde von Fefe 2013 zum letzten Mal verwiesen. Auf sich selber verweist Fefe natürlich auch hin und wieder. Am häufigsten in 2008, mit abnemender Tendenz.</p>
<p><a href="/2019/2019-11-05-fefes-blog-eine-analyse/images/jahr-quellen-ab-50.png"><img src="/2019/2019-11-05-fefes-blog-eine-analyse/images/jahr-quellen-ab-50-700x391.png" alt="Verwendete Quellen / Domains"></a></p>
<p>Verwendete Quellen / Domains</p>
<h2 id="fazit">Fazit</h2>
<p>Und was ist jetzt Fefes WLAN-Passwort? Wir wissen es nicht. Und wir werden es auch nicht erfahren, wenn wir seinen Blog noch drölf mal parsen. Vielleicht sind die zahlreichen zusammengesetzen Substantive als Indiz hilfreich? Egal.</p>
<p>Also gibt es kein Fazit, mit Ausnahme der Feststellung, dass es zeitliche Muster gibt, Fefe ein außerordentliche fleißiger Autor ist aber sonst, leider, die Tendenz der Nachrichtenanzahl in den letzten Jahren zurück gegangen ist.</p>
<h2 id="fehlerquellen-und-technische-hintergründe">Fehlerquellen und technische Hintergründe</h2>
<p>Auch wenn der HTML-Code sehr aufgeräumt ist, vor Fehlern ist auch Fefe nicht gefeit. So gibt es zum Beispiel 110 nicht bzw. falsch geschlossene <A>-Tags. Hier musste ich per Script stumpf ein schließendes </a> setzen, was die Auswertung der Quellen / Domains ein wenig, aber kaum merklich, verfälscht.</p>
<p>Auch bei den Wörtern musste ich etwas aufräumen, um so z.B. alle möglichen Nicht-Buchstaben entfernen. Danach musste ich die Liste noch ein wenig von Hand sortieren, un so z.B. ein paar verirrte URL zu entfernen.</p>
<p>Die verlinkten Quellen war recht einfach zu handhaben. Hier habe ich lediglich die Präfixe entfernt, wenn diese mit www und ggf. einer Ziffer beginnen. Trotzdem muss bei dieser Liste berücksichtigt werden, dass manche Quellen über mehrere Domains erreichbar sind. So verweist Fefe z.B. auf das Angebot der BBC mit zehn verschiedenen Varianten:</p>
<p><a href="/2019/2019-11-05-fefes-blog-eine-analyse/images/grafik-1.png"><img src="/2019/2019-11-05-fefes-blog-eine-analyse/images/grafik-1-700x341.png" alt="Varianten für den Verweis zur BBC"></a></p>
<p>Varianten für den Verweis zur BBC</p>
<p>Der Fefe-Timestamp ist eine Geschichte für sich. Alleine wäre ich vermutlich kaum auf die Idee gekommen, dass hinter der eindeutigen Id, mit der jeder Beitrag erreichbar ist, tatsächlich eine Zeitangabe steckt. <a href="https://www.netaction.de/datenvisualisierung-von-fefes-blogzeiten/">Meine Inspirationsvorlage</a> hat hier zum Glück sehr gute Vorarbeit geleistet und erklärt, wie sich der alphanumerische Wert in ein lesbares Datum umwandeln lässt. Es handelt sich bei dem Wert nämlich um einen Hexadezimalangabe, die zunächst in eine Dezimalziffer umgewandelt werden muss. Danach erfolgt eine bitweise XOR-Operation um einen bestimmten Schlüssel: <strong>0xFEFEC0DE</strong>. Das ergibt schließlich einen Unix-Zeitstempel, der sich in ein lesbares Datum umwandeln lässt.</p>
<p>Zuletzt noch ein Hinweis zu den Daten aus den Anfangszeiten, also März bis Juni 2005. Vermutlich hat Fefe diese nachträglich eingefügt, da dort der Zeitstempel jeweils auf 12 bis 13 Uhr zeigt. Diese Monate habe ich aus den Analysen mit den Tageszeiten ausgeschlossen.</p>
<p>Zuletzt noch ein Hinweis zu den verwendeten Tools:</p>
<p>Einerseits nutze ich für die Auswertung und Darstellung <a href="https://public.tableau.com/en-us/s/">Tableau Public</a>, dass es auch als kostenlose Variante gibt. Für die Wordcloud nutze ich <a href="http://www.wordle.net/">Wordle</a>. Wordle gab es eine zeitlang nur als WebApp, mittlerweile läuft Wordle aber auch als native OSX- oder Windows-Anwendung. Das Python-Script habe ich mit <a href="https://code.visualstudio.com/">Visual Studio Code</a> geschrieben, das im Begriff ist, Notepad++ als Allround-IDE abzulösen. Und mit Excel habe ich die Daten etwas bereinigt, das klappt damit immer noch fixer als mit Tableau.</p>
<h2 id="update">UPDATE</h2>
<p>Durch Zufall bin ich eben noch auf <a href="https://weltliteratur.net/Fefe-Research-Institute/">eine etwas tiefere Textanalyse</a> gestoßen, die auch sehr interessant ist.</p>

        
        
        <div class="tags">
          <p><strong>Tags:</strong> Fefes Blog, Datenanalyse, Web Scraping, Python, Statistik</p>
        </div>
        
      ]]></content:encoded>
      
      
      
      <category>blog</category>
      
      
      
      
      <media:content url="https://nickyreinert.de/images/posts/placeholder.jpg" type="image/jpeg">
        <media:title>Fefes Blog - Eine Analyse - Titelbild</media:title>
      </media:content>
      
      
      
      
      <dc:subject>Lesezeit: 5 Minuten</dc:subject>
      
      
      
      <dc:type>data_analysis</dc:type>
      
      
    </item><item>
      <title>Tutorial: Web-Scraping mit VBA - Teil 1</title>
      <link>https://nickyreinert.de/2010/2010-09-16-tutorial-web-scraping-mit-vba-teil-1/</link>
      <pubDate>Thu, 16 Sep 2010 00:00:00 +0000</pubDate>
      <author></author>
      <guid>https://nickyreinert.de/2010/2010-09-16-tutorial-web-scraping-mit-vba-teil-1/</guid>
      <description>In dieser kleinen Tutorial-Serie will ich anhand einer Online-Handy-Datenbank zeigen, wie man mit VBA Seiten aus dem Internet abruft und nach Informationen …</description>
      
      
      <content:encoded>&lt;![CDATA[
        
        <div class="ai-summary">
          <h3>AI-Zusammenfassung</h3>
          <p>Dies ist der erste Teil einer Tutorial-Reihe, die zeigt, wie man mit VBA in Excel Web-Scraping betreibt. Der Artikel erklärt die Grundlagen des Abrufens von Webseiten-Inhalten mittels &#39;WinHttpRequest&#39; und des Parsens von HTML, um eine Liste von Hersteller-Links von einer Handy-Datenbank-Website zu extrahieren.</p>
          
          
          <p><strong>Hauptthemen:</strong> VBA, Web-Scraping, Excel, HTML-Parsing, Automatisierung</p>
          
          
          
          <p><strong>Schwierigkeitsgrad:</strong> advanced</p>
          
        </div>
        
        
        <p>In dieser kleinen Tutorial-Serie will ich anhand einer Online-Handy-Datenbank zeigen, wie man mit VBA Seiten aus dem Internet abruft und nach Informationen sucht, die sich dann in einer Tabelle abspeichern lassen. Warum VBA? Es gibt vermutlich elegantere Lösungen, doch Excel ist eine Software, die die meisten zuhause nutzen. Man benötigt also keine zusätzliche Entwicklungsumgebung. Außerdem hat diese Methode den  Vorteil, dass die Daten sofort zur weiteren Verarbeitung verfügbar sind. VBA ist vielleicht nicht die performanteste Programmiersprache, dafür aber relativ leicht zu beherrschen.</p>
<p><a href="http://www.rechtzweinull.de/archives/100-screen-scraping-wann-ist-das-auslesen-und-die-veroeffentlichung-fremder-daten-zulaessig.html">(FYI: Rechtliches zum Thema Web- oder Screen-Scraping)</a></p>
<p> 
Diese Artikelserie richtet sich an den fortgeschrittenen Nutzer. Für den Einsteiger gehe ich nicht auf grundlegendes Programmierwissen ein (was sind Klassen, welche Variablen-Typen bietet Excel, etc.pp.) und für den professionellen Softwareentwickler sind meine Codebeispiele vermutlich zu infantil. Ich habe aber die Erfahrung gemacht, dass VBA und Excel für kurzfristige und kleine Projekte dieser Art recht nützliche Hilfsmittel sind. Außerdem bin ich kein &ldquo;ausgebildeter Softwareentwickler&rdquo;, weshalb ich an der Stelle auch gleich darauf Hinweise, dass Verbesserungsvorschläge sehr gerne gesehen sind!</p>
<p>Welches wissen solltest du also mitbringen?  Da es um das Parsen von HTML-Code geht, solltest du zumindest Bescheid wissen, wenn ich von div- und a-Elementen und css-Klassen rede. Du solltest auch wissen, wie man in VBA Variablen deklariert oder was eine if-Abfrage ist.</p>
<p>Das Endergebnis ist eine Tabelle mit technischen Spezifikationen zu den Mobiltelefonen, die inside-handy.de listet. Insgesamt werden drei Routinen genutzt, die - in umgekehrter Reihenfolge des Vorgehens - folgende Aufgabe haben:</p>
<p>Die letzte Routine greift auf eine Liste von URL zu, die auf die Datenblätter der Geräte verweisen. Von dort wird der HTML-Quellcode nach den  technischen Informationen durchsucht.</p>
<p>Auf inside-handy.de sind die Geräte nach Herstellern sortiert. Jede Herstellerseite verweist auf die entsprechenden Geräte. Wir werden also jede Herstellerseite (bzw. den entsprechenden HTML-Code) zunächst nach den URL zu den Geräten durchsuchen. Diese Aufgabe übernimmt die zweite Routine bzw. Prozedur.</p>
<p>Die erste Routine schließlich liefert die Liste aller URL zu den Herstellern, die wir uns aus dem HTML-Code der Herstellerübersicht auf inside-handy.de laden. Und damit geht es nun los:</p>
<p>1. Die URL zu den Hersteller-Unterseiten auslesen - sub getManufacturer</p>
<p>1.1 Datei per HTTP von einem Server laden</p>
<p>Im ersten Schritt laden wir die komplette HTML-Datei in den Zwischenspeicher. Dazu gibt es mindesten zwei Methoden, die gängigste ist vermutlich die über <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa384106%28v=vs.85%29.aspx">WinHttpRequest</a>. Bevor du das nutzen kannst, musst du bei VBA unter Extras - Verweise jedoch erst die Microsoft HTML Object Library einbinden.</p>
<p>&lsquo;&lsquo;&lsquo;vba
Dim url As String
Dim result As String
Dim winHttpReq As Object
url = &ldquo;<a href="http://www.inside-handy.de/hersteller/handys%22">http://www.inside-handy.de/hersteller/handys"</a></p>
<p>Set winHttpReq = CreateObject(&ldquo;WinHttp.WinHttpRequest.5.1&rdquo;)
winHttpReq.Open &ldquo;GET&rdquo;, url, False
winHttpReq.send
result = winHttpReq.responseText
&rsquo;&rsquo;&rsquo;</p>
<p>Die Deklaration der Variablen erklärt sich von selbst. Nachdem ich eine Instanz vom WinHTTP-Objekt erzeugt habe, kann ich die Parameter übergeben. Dazu gehört neben der URL auch die Bestimmung des HTTP-Requests - nämlich GET. Der letzte, booleansche, Paramter gibt an, ob die Verbindung im asynchronen Modus geöffnet werden soll. Mit .send wird der Request tatsächlich ausgelöst und das Ergebni dann an die String-Variable result zurückgegeben. Dort befindet sich nun unser HTML-Code</p>
<p>Wir können unseren Request natürlich auch per POST absetzen und noch andere Header-Informationen anhängen:</p>
<p>&lsquo;&lsquo;&lsquo;vba
Set winHttpReq = CreateObject(&ldquo;WinHttp.WinHttpRequest.5.1&rdquo;)</p>
<p>winHttpReq.Open = &ldquo;Post&rdquo;, url, False
winHttpReq.setRequestHeader &ldquo;User-Agent&rdquo;, &ldquo;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)&rdquo;
winHttpReq.setRequestHeader &ldquo;Content-type&rdquo;, &ldquo;application/x-www-form-urlencoded&rdquo;
winHttpReq.send (URLEncode(&ldquo;username=user1&amp;password=secret&rdquo;) )</p>
<p>result = winHttpReq.responseText
&rsquo;&rsquo;&rsquo;</p>
<p>So ist es z.B. möglich, Formulardaten zu übermitteln, um an eine passwortgeschützte Seite oder die Ergebnisseite einer Suche zu gelangen. Dabei werden die POST-Daten als weiterer Parameter beim Senden mitgegeben. Eine weitere Möglichkeit ist die Durchführung einer HTTP-Authentifizierung:</p>
<p>&lsquo;&lsquo;&lsquo;vba
Dim HTTPREQUEST_SETCREDENTIALS_FOR_SERVER As Boolean</p>
<p>winHttpReq.Open &ldquo;GET&rdquo;, url, False
winHttpReq.SetCredentials &ldquo;user&rdquo;, &ldquo;password&rdquo;, HTTPREQUEST_SETCREDENTIALS_FOR_SERVER
winHttpReq.send
&rsquo;&rsquo;&rsquo;</p>
<p>Neben dem winHttpRequest-Objekt gibt es noch eine weniger elegante Methoden, in dem direkt eine Instanz des Internet Explorers erzeugt wird:</p>
<p>&lsquo;&lsquo;&lsquo;vba
Dim sPostData As String
Dim bPostData() As Byte
Dim WebBrowser: Set WebBrowser = CreateObject(&ldquo;InternetExplorer.Application&rdquo;)</p>
<p>WebBrowser.Visible = True</p>
<p>sPostData = URLEncode(&ldquo;username=user1&amp;password=secret&rdquo;)
ReDim bPostData(Len(sPostData) - 1)
bPostData = StrConv(sPostDataData, vbFromUnicode)</p>
<p>WebBrowser.navigate url, 2 + 4 + 8, , bPostData, &ldquo;Content-type: application/x-www-form-urlencoded&rdquo;
Do While WebBrowser.Busy
DoEvents
Loop
result = WebBrowser.document.body.innerHTML
WebBrowser.Quit
&rsquo;&rsquo;&rsquo;</p>
<p>Da diese Methode - wie gesagt - nicht sonderlich elegant ist, werde ich aber nicht weiter darauf eingehen.</p>
<p>Nun zurück zu unserem Skript. Den HTML-Code der Seite haben wir nun erstmal in einen String gelegt. Damit wir das HTML-Dokument bequem lesen können, erzeugen wir ein HTML-Document, an das wir den HTML-Code übergeben:</p>
<p>&lsquo;&lsquo;&lsquo;vba
Set HTMLDoc = New HTMLDocument
Set HTMLDoc = CreateObject(&ldquo;htmlfile&rdquo;)
HTMLDoc.Open
HTMLDoc.write (CStr(result))
HTMLDoc.Close
&rsquo;&rsquo;&rsquo;</p>
<p>Auch hier erklärt sich der Code fast von selber: Eine Instanz des Objektes erzeugen, diese Instanz zum &ldquo;Befüllen&rdquo; vorbereiten, den String übergebne und die Instanz wieder &ldquo;schließen&rdquo;. Soweit, so unkompliziert. Im nächsten Schritt geht es nun direkt an das Parsen des Quellcodes um die Links zu den Herstellerseiten zu erhalten. Die Schleife dazu ist nicht sehr aufwendig:</p>
<p>&lsquo;&lsquo;&lsquo;vba
Dim oneElement1, allElements1 As IHTMLElementCollection
Dim oneElement2, allElements2 As IHTMLElementCollection
Dim oneElement3, allElements3 As IHTMLElementCollection</p>
<pre><code>Worksheets(&quot;srcURL&quot;).Range(&quot;a2&quot;).Select
i = 0
Set allElements1 = HTMLDoc.getElementsByTagName(&quot;a&quot;)
      
i = 0
For Each oneElement1 In allElements1
    If oneElement1.parentElement.className = &quot;h\_img&quot; Then
        If oneElement1.parentElement.parentElement.ID = &quot;h\_alle&quot; Then
            If InStr(1, oneElement1.getAttribute(&quot;href&quot;), &quot;/tablets&quot;) &lt;= 0 Then
                Selection.Offset(i, 0).Value = Replace(oneElement1.getAttribute(&quot;href&quot;), &quot;about:&quot;, &quot;http://www.inside-handy.de&quot;)
                i = i + 1
            End If
        End If
        
    End If    
Next oneElement1
</code></pre>
<p>End Sub
&rsquo;&rsquo;&rsquo;</p>
<p>Wie bin ich vorgegangen? Ich habe mir zunächst den Quellcode der Seite angeschaut. Die Liste der Hersteller ist dort eine Tabelle mit den Logos der Unternehmen. Die gewünschte Information befindet sich in a-Elementen, die wiederum innerhalb eines div-Elements liegen. Das gemeinsame &ldquo;Oberelement&rdquo; ist ein div-Container mit der CSS-Klasse &ldquo;h_img&rdquo; bzw. einem weiterne div-Container (&ldquo;h_alle&rdquo;). Außerdem gibt es einen ausgeblendeten div-Container mit einer Liste von Tablet-Herstellern, diese haben den Begriff &ldquo;/tablet&rdquo; in der href-Angabe und müssen ignoriert werden.</p>
<p>&lsquo;&lsquo;&lsquo;html</p>
<div id="h\_alle">
	<div class="h\_img">
		<a href="/hersteller/xyz" title="Handys Hersteller: XYZ">
			<img />
		</a>
	</div>
</div>
'''
<p>Mit &ldquo;Set allElements1 = HTMLDoc.getElementsByTagName(&ldquo;a&rdquo;)&rdquo; lasse ich mir also erst alle a-Elemente aus dem Quellcode in meinen &ldquo;Container&rdquo; legen.</p>
<p>Mit der ersten for-each-Schleife durchlaufe ich nun diesen Container und prüfe mit den ersten zwei if-Abfragen, ob sich das a-Element unterhalb der erwähnten div-Container befindet. Da auf der Seite noch ein weitere identische div-Container mit diesen css-Klassen für die Liste der Tablet-Hersteller existiert, muss ich mit einer dritten if-Abfrage die URL des a-Elements überprüfen. Erst dann kann ich das Attribut des a-Elements auslesen und in mein Excel-Worksheet schreiben.</p>
<p>Fertig ist der erste Schritt - eine Liste der URL zu den jeweiligen Herstellern. Im nächsten Teil werde ich diese Liste durchgehen und von den jeweiligen Seiten die URL zu den Geräten auslesen.</p>

        
        
        <div class="tags">
          <p><strong>Tags:</strong> VBA, Excel, Web-Scraping, Tutorial</p>
        </div>
        
      ]]></content:encoded>
      
      
      
      <category>development</category>
      
      <category>office</category>
      
      <category>anleitungen</category>
      
      
      
      
      <media:content url="https://nickyreinert.de/images/posts/placeholder.jpg" type="image/jpeg">
        <media:title>Tutorial: Web-Scraping mit VBA - Teil 1 - Titelbild</media:title>
      </media:content>
      
      
      
      
      <dc:subject>Lesezeit: 5 Minuten</dc:subject>
      
      
      
      <dc:type>tutorial</dc:type>
      
      
    </item>
  </channel>
</rss>